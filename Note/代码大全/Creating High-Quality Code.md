# Creating High-Quality Code
## 第五章 软件构建中的设计
### 5.1 设计中的挑战
- 设计是一个险恶的问题
  - “险恶的问题”指只有通过解决或部分解决才能被明确的问题，即把这个问题“解决”一遍才能够明确定义，才能再次解决从而形成一个可行的方案。
- 设计是个了无章法的过程（即使得到的成果是清爽的）
  - 在设计的过程中会犯很多错，在设计阶段修改错误是设计的关键所在。
  - 优、劣设计之间的差异往往非常微妙。
  - 无法判断设计何时算“足够好”。设计永无止境。
- 设计就是确定取舍和调整顺序的过程
  - 设计者工作的一个关键内容便是去衡量彼此冲突的各项设计特性，并尽力在其中寻求平衡。比如程快速的反应速度和缩减开发时间之间的冲突，或者内存和运行时间的冲突等。
- 设计收到诸多限制
  - 设计的要点，一部分是在创造可能发生的事情，另一部分又是在限制可能发生的事情。设计是在有限的资源中寻找最好的方案。
- 设计是不确定的
  - 设计同样一套程序，可能会出现很多种截然不同的设计方法。
- 设计是一个启发式的过程
  - 设计的过程充满不确定性，设计技术也就趋于探索性而不是保证能产生预期结果的可重复过程。因为没有任何工具是完全在各个方面通用的。
- 设计是自然而然形成的
  - 把上面的特性综合归纳起来看，设计是在不断地设计评估、非正式讨论、些试验代码并修改试验代码中演化和完善的。

### 5.2 关键的设计理念
- 软件的首要技术使命：管理复杂度
  - 偶然的难题和本质的难题
    这两类不同的问题导致软件开发变得困难。
    
    偶然的属性指的是一件事物碰巧具有的属性，有没有这些属性都不影响这件事物本身，是一些附属的、随机的、非必要的或者偶然出现的性质。且这些问题大多已经被解决。
    
    本质上的困难来源于复杂性，究其原因是软件开发就是不断地去发掘错综复杂、相互连接的整套概念的所有细节的过程。必须去面对复杂无序的现实世界、精确完整地识别各种依赖关系和例外情况、设计出完全正确而非大致正确的解决方案等。
  - 管理复杂度的重要性
    软件的首要技术使命便是管理复杂度。当项目由技术因素导致失败时，其原因通常是失控的复杂度，有关的软件变得极端复杂，当没人能知道对一处代码的改动会对其他代码带来什么影响时，项目也就快停止进展了。
    
    我们不应该在同一时间把整个程序都塞进自己大脑，应该以某种方式去组织程序，以便能够在同一时刻只专注于一个特定的部分（读这段话时的想法：从结构化编程到面向对象编程也许是遵从了这个思想？）。
此时出现bug的原因则是漏掉了整个程序的某一个部分，

    在软件架构的层次上通过把整个系统分解为多个子系统降低问题的复杂度，保持每个子系统功能的简单，且减少子系统间的相互依赖，子系统间相互依赖越少越容易在同一时间专注问题的一小部分。
保持子程序的短小精悍也能帮助减少思考负担。从问题的领域着手而不是从底层实现细节入手编写程序，在抽象层次上工作也能减少负担。
  - 如何应对复杂度
    高代价、低效率的设计的根源：
      1.用复杂的方法解决简单的问题。
      2.用简单但错误的方法解决复杂的问题。
      3.用不恰当的复杂方法解决复杂问题。
    用下面的方法管理复杂度：
      1.把任何人在同一时间需要处理的本质复杂度的量减到最少。
      2.不要让偶然性的复杂度无所谓地快速增长。
- 理想设计的特征
    - 最小的复杂度。避免在不必要时用“聪明的”设计（例如在没有相关需求时用上精妙却一时难以理解的算法，或者滥用设计模式），因为这些设计通常难以理解。
    - 易于维护。例如自解释的变量名、方法名等。
    - 松散耦合。让程序的各个组成部分间的关联最小。通过应用类接口中的合理抽象、封装性及信息隐藏等原则设计出相互关联尽可能少的类。会减轻测试维护时的工作量。
    - 可扩展性。能增强系统功能而无须破坏其底层结构，能改动某一部分而不影响其他部分。
    - 可重用性。
    - 高扇入。让大量的类使用某个给定的类，如工具类。
    - 低扇出。让一个类里少量或适中地引用其他类。高扇出（大于7个）说明一个类大量使用了其他类，可能使得其变得过于复杂。对于子程序和类而言，低扇出原则都是有利的。
    - 精简性。设计出的系统没有多余的部分，因为任何多余的代码都需要开发、复审和测试，并且在修改其他代码后还需要重新考虑它们的兼容。
    - 层次性。尽量保持系统各个分解层的层次性，使得开发人员能够在任意的单一的层面上观察系统。这样一是可以把低劣的代码屎山禁闭起来不扩散，二是在抛弃或者重构代码时不必修改除了交互层外的任何新代码。
    - 标准技术。开发时的统一标准。
- 设计的层次
